---
title: 삽질만 한 하루
createBy: 2024-05-07
description: 거의 하루종일 삽질했다.
charter: 일지
tags: ["일지"]
---

## 회사

회사에서 PDF.JS 관련해서 좌측에 미리보기 기능도 구현했었는데 단순하게 문제가 PDF 로딩자체가 오래걸렸다.  
문제점에 대한 메인은 부모 컴포넌트에서는 PDF 문서 로드를 진행하고, 자식 컴포넌트에서는 페이지마다 그려주는 역할을 했는데  
모든 자식 컴포넌트가 로드가 될 때까지 부모 컴포넌트가 로드가 되지 않는 문제를 가지고 있었다.

원래 PDF 로딩이 느린가 싶어서 관련 자료 또는 타 사이트도 검색해봤지만 유난히 VUE의 구조라서 그런지 전체 로딩을 벗어날 수가 없었다.  
그래서 별로도 분류하는 방법을 좀 생각하다가 좋은 아이디어가 떠올랐는데 퇴근 시간쯤이라 커밋하고 집에서 하기로 했다.

## 학교

오랜만에 학교에 갔다. 오늘은 회사에 일찍 출근해서 평상시보다 학교에 20분정도 일찍 도착했었는데 여유가 참 많았다.  
학교에서는 대회 문제 또는 디자인 관련에서 검토하고 대략 일정 정도만 파악하고 끝 마쳤다.

## 집

집에 갈 때 좀 피곤했는데 비타 500 구매하고 집에서 마시고 PDF.JS 관련해서 삽질 다시 시작했다.  
일단 회사에서 생각했던 아이디어 자체는 무의미 했다. 굳이 따지자면 콘솔을 일일이 찍어서 확인해본 결과가 놀라웠다.  
내가 생각했던 오래걸리는 파트는 PDF문서의 페이지 로드였는데 실질적으로 시간이 소요된 부분은 PDF페이지를 캔버스로 렌더링하는 파트였다.

캔버스로 렌더링을 진행하는 파트에서 모든 자식 요소 스코프가 종료될 때까지 부모요소가 렌더링이 되지 않음을 어느정도 알아챘다.  
나름 앉아서 생각하고 고민을 해본 결과 자세하게는 모르겠지만 캔버스 렌더링 과정이 바로 진행되는게 아닌 어느정도 딜레이를 거치고 되는거 같았다.  
이 부분은 Vue의 렌더링 기법의 이해 문제가 생긴거라고 생각한다. 왜냐하면 PDF 페이지를 5개 로드하는것과 30개 로드할 때 첫 페이지 로드 속도는 동일해야하는데 동일하지 않았다.  
최종적으로 문제의 해결은 이벤트 루프에 있었다. 평상시에 별로 생각하지 않는 문제였지만 자바스크립트 자체가 싱글쓰레드라 setTimeout를 사용해서 문제를 해결했다.

대략 문제에 대한 로딩 점진적 로딩은 어느정도 적용이 됐지만 예외처리도 필요하며, 줌 기능도 추가해야하고 번거로운게 아직은 좀 많다고 생각한다.  
내일까지 PDF쪽은 클리어하는 걸로 목표를 세우고 있고, 자바스크립트에 대해 깊게 공부할 필요가 있다고 다시 생각하게 된다.
